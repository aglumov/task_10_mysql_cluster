## Подготовка к запуску
Публичный ключ должен находиться по пути: ```~/.ssh/id_rsa.pub```

В системе должны быть установлены ansible и terraform. Тестировалось на версиях:
- ansible [core 2.13.8]
  - community.mysql 3.7.2
  - community.proxysql 1.5.1
- terraform v1.5.5
  
## Настройка и запуск
- склонировать репозиторий;
- настроить подключение к облаку яндекс. Для этого перейти в каталог ```terrafom``` создать файл ```yc.auto.tfvars``` с содержимым (подставить свой токен, id облака и каталога):
```
yc_token     = токен
yc_cloud_id  = id облака
yc_folder_id = id каталога
```
- инициализировать терраформ: ```terraform init```
- запустить создание инфраструктуры: ```terraform apply -var-file common.tfvars```
- после создания инфраструктуры дождаться загрузки ВМ
- перейти в каталог ```ansible``` и запустить плейбук: ```ansible-playbook setup.yaml```
- при успешном выполнении плейбука в выводе terraform взять ip-адрес из ```nginx_public_ip_address``` и подключиться по http.

## Схема проекта
```
                                                 ╔════════════╗
                ┌───────── app0(proxysql) ──────>║  db0────┐  ║
client <─────> lb0                               ║   │    db2 ║
                └───────── app1(proxysql) ──────>║  db1────┘  ║
                                                 ╚════════════╝
```
### Пояснения
Кластер баз данных собран при помощи Percona XtraDB Cluster. App серверы подключаются к кластеру через локально установленный ProxySQL.
